# youtube-burgundy
Convert youtube videos to mp3 to extract audio for creating offline playlists

## Setup
Github link: `https://github.com/awilson96/youtube-burgundy`
1. git clone `https://github.com/awilson96/youtube-burgundy`
2. Install nginx on the same hard drive where you want your downloads folder to be for hosting the downloaded mp4 files. nginx download: `https://nginx.org/en/download.html`. On MacOS this can be done in the terminal with the command `brew install nginx`.
3. If you don't already have miniconda or anaconda, install at `https://www.anaconda.com/docs/getting-started/miniconda/install`
4. To create the conda environment run the command `conda env create -f environment.yaml` for Windows and `conda env create -f environment_mac.yaml` for MacOS. Or if you prefer not to use conda see the requirements.txt file for a more concise the list of dependencies needed to run this program and just ensure you have installed these before running.
5. If using conda, run `conda activate YoutubeBurgundy`
6. Run `setup.py` and select the folder where you would like your mp4 files to be stored/hosted (For example I use `D:\\ on Windows`). Note this script alters the `nginx.conf` file which will be used later! 
7. Replace the newly modified `nginx.conf` file with the existing in the folder location where you extracted nginx at the location <NGINX_ROOT>/conf/nginx.conf (i.e. in my case <NGINX_ROOT>=nginx-1.28.0, this will depend on what version you install). If you are on MacOS:
- `sudo mkdir -p $(brew --prefix nginx)/etc/nginx`
- Then from the root of this repo run `sudo cp nginx.conf /usr/local/etc/nginx/nginx.conf` to replace the default nginx config with the newly generated one. 
- You can test that the syntax is correct by running `nginx -t`
8. To setup VPN install Wireguard `https://www.wireguard.com/install/`. This is used to put your phone on the same network as your computer.
9. Open the application on your computer and select the dropdown for `Add Tunnel` and select `Add empty tunnel...`. Name it something sensible (i.e. iPhone_VPN).
10. Then, paste in this VPN config being sure to use the autogenerated private key given by wiregaurd. Note that you won't have the public key for your phone just yet until you setup the VPN config for your phone in future steps. Note that if you are on MacOS you do not need the `PostUp` or `PostDown` commands as these are not valid on Mac. Your computer VPN config should look something like this: 
```ini
[Interface]
PrivateKey = <YOUR_AUTOGENERATED_PRIVATE_KEY>
ListenPort = 51820
Address = 10.0.0.1/24

# Remove this line in MacOS config
PostUp = netsh interface ipv4 set interface "Ethernet" forwarding=ENABLED
# Remove this line in MacOS config
PostDown = netsh interface ipv4 set interface "Ethernet" forwarding=DISABLED

[Peer]
PublicKey = <YOUR_PHONE_VPN_PUBLIC_KEY>
AllowedIPs = 10.0.0.2/32
```
11. Install Wireguard on your phone (i.e. from the app store) and fill in these parameters. Note that <YOUR_AUTOGENERATED_PHONE_PUBLIC_KEY> is generated by your phone and <YOUR_COMPUTER'S_PUBLIC_KEY> was generated in the previous step and can be retrieved from the already created computer vpn config. You can retrieve your public IPV4 address from `https://www.whatismyip.com`.
```ini
[Interface]
Name = Computer_VPN
Public key = <YOUR_AUTOGENERATED_PHONE_PUBLIC_KEY>
Addresses = 10.0.0.2/32
Listen Port 57609
DNS servers 1.1.1.1

[Peer]
Public key = <YOUR_COMPUTER_PUBLIC_KEY>
Endpoint = <YOUR_PUBLIC_IP_ADDRESS>:51820
Allowed IPs = 10.0.0.0/24
```
12. If you haven't already go back and finish `step 10.` by adding <YOUR_PHONE_VPN_PUBLIC_KEY> to the config by editing the existing config in Wireguard.
13. Once everything is setup you can activate the VPN on your computer and your phone and test the connection. Be sure there are no firewall rules preventing the connection on your computer. I use a tool called `Ping network utility` on iPhone for testing the connection by pinging 10.0.0.1 (the computer's ip address). Then on my computer I test the connection to the phone by pinging 10.0.0.2 (The phones ip address). If you are noticing that pings are not making it through from your phone to your home router you may need to create a firewall rule on your home router: (Note: optional if ping is successful)
- Navigate to your router's IP address. If you have AT&T, type the Ip Address in your browser.
- Navigate to Firewall > NAT/Gaming > Custom Service. 
- Then enter `Wireguard` for the `Service Name`, `51820 - 51820` for the `Global Port Range`, `51820` for the `Base Host Port` and `Protocol TCP/UDP`. 
- Then click Add. 
- Now navigate back to NAT/Gaming and select the service `Wireguard` and then in `Needed by Device`, select the name of your computer. 

14. Navigate to the folder where you installed nginx and run `start nginx` on windows. On MacOS, to start nginx now and restart at login: `brew services start nginx`. Or, if you don't want/need a background service you can just run: `/opt/homebrew/opt/nginx/bin/nginx -g daemon\ off\;` This shares your selected folder with the web app so that it can access files you download. Note that this needs to keep running for the app to work so a background service may be best if you plan on keeping this running indefinetely.
15. Run the following command in a terminal with the `YoutubeBurgundy` conda environment activated: `uvicorn youtube2web:app --host 0.0.0.0 --port 8000`. This starts the web app. Note that you may need to close the terminal completely to stop the process as `control+C` does not work to stop the process sometimes.
16. To stop the server run `nginx -s stop` on Windows. On MacOS if you ran the process manually just `control+C` out of the process or taskkill it. If you ran it as a background process, then simply run `brew services stop nginx`, then run `brew services list` to confirm it is no longer running.
